<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulasi Koneksi Jaringan Digital</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: auto;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    .app-wrapper {
      height: 100%;
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      height: 100%;
      max-width: 1400px;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 15px;
    }

    .main-content {
      flex: 1;
      display: grid;
      grid-template-columns: 55% 45%;
      gap: 20px;
      overflow: hidden;
    }

    .left-panel {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 15px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .reset-btn {
      background: #f56565;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
      width: 100%;
      margin-top: auto;
    }

    .reset-btn:hover {
      background: #e53e3e;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 101, 101, 0.5);
    }

    .main-title {
      font-size: 24px;
      font-weight: bold;
      color: #2d3748;
      margin-bottom: 5px;
    }

    .intro-text {
      font-size: 14px;
      color: #4a5568;
      margin-bottom: 0;
    }

    .phase-indicator {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #cbd5e0;
      transition: all 0.3s ease;
    }

    .phase-dot.active {
      background: #667eea;
      transform: scale(1.3);
    }

    .instruction-box {
      background: #edf2f7;
      padding: 12px 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .instruction-text {
      font-size: 13px;
      color: #2d3748;
      margin: 0;
    }

    .network-canvas {
      background: #f7fafc;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      flex: 1;
      border: 2px dashed #cbd5e0;
    }

    .device {
      position: absolute;
      width: 80px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .device:hover {
      transform: scale(1.1);
    }

    .device-icon {
      width: 60px;
      height: 60px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      margin: 0 auto 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 3px solid #cbd5e0;
    }

    .device.selected .device-icon {
      border-color: #667eea;
      background: #edf2f7;
    }

    .device-label {
      font-size: 12px;
      color: #2d3748;
      font-weight: 600;
    }

    .connection-line {
      position: absolute;
      background: #48bb78;
      height: 3px;
      transform-origin: left center;
      pointer-events: none;
      z-index: 1;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #48bb78;
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #38a169;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-panel {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
    }

    .status-title {
      font-size: 14px;
      font-weight: bold;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .connection-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .connection-item {
      background: #edf2f7;
      padding: 8px 10px;
      border-radius: 6px;
      font-size: 12px;
      color: #2d3748;
    }

    .message-panel {
      background: #fff5f5;
      border: 2px solid #feb2b2;
      border-radius: 8px;
      padding: 12px;
    }

    .message-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .message-input {
      width: 100%;
      padding: 8px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 12px;
    }

    .packet-display {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .packet {
      background: #667eea;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
    }

    .route-display {
      background: #f0fff4;
      border: 2px solid #9ae6b4;
      border-radius: 8px;
      padding: 12px;
      margin-top: 10px;
    }

    .route-path {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .route-node {
      background: #48bb78;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 11px;
    }

    .route-arrow {
      font-size: 16px;
      color: #48bb78;
    }

    .packet-animation {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #f56565;
      border-radius: 50%;
      pointer-events: none;
      z-index: 10;
    }

    .info-box {
      background: #ebf8ff;
      border: 2px solid #90cdf4;
      border-radius: 8px;
      padding: 12px;
    }

    .info-title {
      font-size: 13px;
      font-weight: bold;
      color: #2c5282;
      margin-bottom: 6px;
    }

    .info-text {
      font-size: 11px;
      color: #2d3748;
      line-height: 1.5;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper">
   <div class="container">
    <div class="header">
     <h1 class="main-title" id="mainTitle">Simulasi Koneksi Jaringan Digital</h1>
     <p class="intro-text" id="introText">Mari belajar bagaimana internet bekerja dengan paket data dan routing!</p>
    </div>
    <div class="phase-indicator">
     <div class="phase-dot active" id="phase1"></div>
     <div class="phase-dot" id="phase2"></div>
     <div class="phase-dot" id="phase3"></div>
    </div>
    <div class="instruction-box">
     <p class="instruction-text" id="instructionText">Fase 1: Hubungkan perangkat dengan memilih 2 perangkat lalu klik "Hubungkan Perangkat". Minimal 1 koneksi diperlukan.</p>
    </div>
    <div class="main-content">
     <div class="left-panel">
      <div class="network-canvas" id="networkCanvas">
       <div class="device" id="device1" style="left: 15%; top: 15%;">
        <div class="device-icon">
         üíª
        </div>
        <div class="device-label">
         Komputer 1
        </div>
       </div>
       <div class="device" id="device2" style="left: 75%; top: 15%;">
        <div class="device-icon">
         üíª
        </div>
        <div class="device-label">
         Komputer 2
        </div>
       </div>
       <div class="device" id="device3" style="left: 45%; top: 5%;">
        <div class="device-icon">
         üåê
        </div>
        <div class="device-label">
         Router
        </div>
       </div>
       <div class="device" id="device4" style="left: 25%; top: 70%;">
        <div class="device-icon">
         üì±
        </div>
        <div class="device-label">
         Smartphone
        </div>
       </div>
       <div class="device" id="device5" style="left: 65%; top: 70%;">
        <div class="device-icon">
         üñ•Ô∏è
        </div>
        <div class="device-label">
         Server
        </div>
       </div>
      </div>
     </div>
     <div class="right-panel">
      <div class="controls"><button class="btn btn-primary" id="connectBtn" disabled>Hubungkan Perangkat</button> <button class="btn btn-secondary" id="finishNetworkBtn" disabled>Selesai Membuat Jaringan</button> <button class="btn btn-secondary" id="sendMessageBtn" style="display: none;">Kirim Pesan</button>
      </div>
      <div class="status-panel">
       <div class="status-title">
        Koneksi Jaringan (0 koneksi)
       </div>
       <div class="connection-list" id="connectionList">
        <div style="color: #a0aec0; font-style: italic;">
         Belum ada koneksi
        </div>
       </div>
      </div>
      <div class="message-panel" id="messagePanel" style="display: none;">
       <div class="status-title">
        Pengiriman Pesan
       </div>
       <div class="message-controls"><select class="message-input" id="fromDevice"> <option value="">Dari perangkat...</option> </select> <select class="message-input" id="toDevice"> <option value="">Ke perangkat...</option> </select> <input type="text" class="message-input" id="messageText" placeholder="Tulis pesan Anda...">
       </div>
       <div id="packetDisplay"></div>
       <div id="routeDisplay"></div>
      </div>
      <div class="info-box">
       <div class="info-title">
        üí° Tahukah Kamu?
       </div>
       <p class="info-text">Internet bekerja dengan memecah data menjadi paket-paket kecil. Setiap paket menemukan jalurnya sendiri melalui router, dan bergabung kembali di tujuan.</p>
      </div><button class="reset-btn" id="resetBtn">üîÑ Reset Simulasi</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      main_title: "Simulasi Koneksi Jaringan Digital",
      intro_text: "Mari belajar bagaimana internet bekerja dengan paket data dan routing!",
      instruction_text: "Fase 1: Hubungkan perangkat dengan memilih 2 perangkat lalu klik \"Hubungkan Perangkat\". Minimal 1 koneksi diperlukan."
    };

    let currentPhase = 1;
    let selectedDevices = [];
    let connections = [];
    let graph = {};

    const devices = ['device1', 'device2', 'device3', 'device4', 'device5'];
    const deviceNames = {
      'device1': 'Komputer 1',
      'device2': 'Komputer 2',
      'device3': 'Router',
      'device4': 'Smartphone',
      'device5': 'Server'
    };

    devices.forEach(id => {
      graph[id] = [];
    });

    function onConfigChange(config) {
      document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
      document.getElementById('introText').textContent = config.intro_text || defaultConfig.intro_text;
      document.getElementById('instructionText').textContent = config.instruction_text || defaultConfig.instruction_text;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['main_title', config.main_title || defaultConfig.main_title],
        ['intro_text', config.intro_text || defaultConfig.intro_text],
        ['instruction_text', config.instruction_text || defaultConfig.instruction_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    devices.forEach(deviceId => {
      const device = document.getElementById(deviceId);
      device.addEventListener('click', () => {
        if (currentPhase !== 1) return;
        
        if (selectedDevices.includes(deviceId)) {
          selectedDevices = selectedDevices.filter(id => id !== deviceId);
          device.classList.remove('selected');
        } else if (selectedDevices.length < 2) {
          selectedDevices.push(deviceId);
          device.classList.add('selected');
        }

        document.getElementById('connectBtn').disabled = selectedDevices.length !== 2;
      });
    });

    document.getElementById('connectBtn').addEventListener('click', () => {
      if (selectedDevices.length === 2) {
        const [dev1, dev2] = selectedDevices;
        
        const alreadyConnected = connections.some(conn => 
          (conn[0] === dev1 && conn[1] === dev2) || (conn[0] === dev2 && conn[1] === dev1)
        );

        if (!alreadyConnected) {
          connections.push([dev1, dev2]);
          graph[dev1].push(dev2);
          graph[dev2].push(dev1);
          drawConnection(dev1, dev2);
          updateConnectionList();
        }

        selectedDevices.forEach(id => {
          document.getElementById(id).classList.remove('selected');
        });
        selectedDevices = [];
        document.getElementById('connectBtn').disabled = true;

        if (connections.length >= 1) {
          document.getElementById('finishNetworkBtn').disabled = false;
        }
      }
    });

    document.getElementById('finishNetworkBtn').addEventListener('click', () => {
      if (connections.length < 1) {
        return;
      }

      currentPhase = 2;
      document.getElementById('phase1').classList.remove('active');
      document.getElementById('phase2').classList.add('active');
      
      if (window.elementSdk) {
        window.elementSdk.setConfig({
          instruction_text: "Fase 2: Pilih perangkat pengirim dan penerima, lalu tulis pesan untuk dikirim"
        });
      }

      document.getElementById('connectBtn').style.display = 'none';
      document.getElementById('finishNetworkBtn').style.display = 'none';
      document.getElementById('messagePanel').style.display = 'block';
      document.getElementById('sendMessageBtn').style.display = 'inline-block';

      const fromSelect = document.getElementById('fromDevice');
      const toSelect = document.getElementById('toDevice');
      
      devices.forEach(id => {
        const option1 = document.createElement('option');
        option1.value = id;
        option1.textContent = deviceNames[id];
        fromSelect.appendChild(option1);

        const option2 = document.createElement('option');
        option2.value = id;
        option2.textContent = deviceNames[id];
        toSelect.appendChild(option2);
      });

      devices.forEach(id => {
        document.getElementById(id).style.cursor = 'default';
      });
    });

    function drawConnection(dev1, dev2) {
      const elem1 = document.getElementById(dev1);
      const elem2 = document.getElementById(dev2);
      const canvas = document.getElementById('networkCanvas');

      const rect1 = elem1.getBoundingClientRect();
      const rect2 = elem2.getBoundingClientRect();
      const canvasRect = canvas.getBoundingClientRect();

      const x1 = rect1.left - canvasRect.left + rect1.width / 2;
      const y1 = rect1.top - canvasRect.top + rect1.height / 2;
      const x2 = rect2.left - canvasRect.left + rect2.width / 2;
      const y2 = rect2.top - canvasRect.top + rect2.height / 2;

      const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
      const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

      const line = document.createElement('div');
      line.className = 'connection-line';
      line.style.width = length + 'px';
      line.style.left = x1 + 'px';
      line.style.top = y1 + 'px';
      line.style.transform = `rotate(${angle}deg)`;

      canvas.appendChild(line);
    }

    function updateConnectionList() {
      const listContainer = document.getElementById('connectionList');
      listContainer.innerHTML = '';

      if (connections.length === 0) {
        listContainer.innerHTML = '<div style="color: #a0aec0; font-style: italic;">Belum ada koneksi</div>';
      } else {
        connections.forEach(([dev1, dev2]) => {
          const item = document.createElement('div');
          item.className = 'connection-item';
          item.textContent = `${deviceNames[dev1]} ‚Üî ${deviceNames[dev2]}`;
          listContainer.appendChild(item);
        });
      }

      document.querySelector('.status-title').textContent = `Koneksi Jaringan (${connections.length} koneksi)`;
    }

    document.getElementById('sendMessageBtn').addEventListener('click', () => {
      const fromDevice = document.getElementById('fromDevice').value;
      const toDevice = document.getElementById('toDevice').value;
      const message = document.getElementById('messageText').value;

      // Clear previous error messages
      const existingError = document.getElementById('errorMessage');
      if (existingError) {
        existingError.remove();
      }

      if (!fromDevice || !toDevice || !message) {
        showError('Mohon lengkapi semua kolom (pengirim, penerima, dan pesan)!');
        return;
      }

      if (fromDevice === toDevice) {
        showError('Perangkat pengirim dan penerima tidak boleh sama!');
        return;
      }

      // Check if devices are connected
      const paths = findAllPaths(fromDevice, toDevice);
      if (paths.length === 0) {
        showError(`‚ùå Tidak ada jalur yang menghubungkan ${deviceNames[fromDevice]} dengan ${deviceNames[toDevice]}! Silakan pilih perangkat yang terhubung dalam jaringan.`);
        return;
      }

      currentPhase = 3;
      document.getElementById('phase2').classList.remove('active');
      document.getElementById('phase3').classList.add('active');

      if (window.elementSdk) {
        window.elementSdk.setConfig({
          instruction_text: "Fase 3: Lihat bagaimana pesan dipecah menjadi paket dan menemukan rutenya!"
        });
      }

      const packets = splitIntoPackets(message);
      displayPackets(packets);

      displayRoute(paths);

      if (paths.length > 0) {
        animatePackets(paths[0]);
      }
    });

    function showError(message) {
      const messagePanel = document.getElementById('messagePanel');
      const errorDiv = document.createElement('div');
      errorDiv.id = 'errorMessage';
      errorDiv.style.cssText = 'background: #fed7d7; border: 2px solid #fc8181; border-radius: 8px; padding: 15px; margin-top: 15px; color: #c53030; font-weight: 600; text-align: center;';
      errorDiv.textContent = message;
      messagePanel.appendChild(errorDiv);
    }

    function splitIntoPackets(message) {
      const packets = [];
      const chunkSize = 5;
      for (let i = 0; i < message.length; i += chunkSize) {
        packets.push(message.substring(i, i + chunkSize));
      }
      return packets;
    }

    function displayPackets(packets) {
      const container = document.getElementById('packetDisplay');
      container.innerHTML = '<div style="font-weight: bold; margin-bottom: 10px; width: 100%;">Pesan dipecah menjadi paket:</div>';
      
      packets.forEach((packet, index) => {
        const packetElem = document.createElement('div');
        packetElem.className = 'packet';
        packetElem.textContent = `Paket ${index + 1}: "${packet}"`;
        container.appendChild(packetElem);
      });
    }

    function findAllPaths(start, end) {
      const allPaths = [];
      const visited = new Set();

      function dfs(current, target, path) {
        if (current === target) {
          allPaths.push([...path]);
          return;
        }

        visited.add(current);

        for (const neighbor of graph[current]) {
          if (!visited.has(neighbor)) {
            path.push(neighbor);
            dfs(neighbor, target, path);
            path.pop();
          }
        }

        visited.delete(current);
      }

      dfs(start, end, [start]);
      
      // Sort paths by length (shortest first)
      allPaths.sort((a, b) => a.length - b.length);
      
      return allPaths;
    }

    function displayRoute(paths) {
      const container = document.getElementById('routeDisplay');
      container.innerHTML = '<div style="font-weight: bold; margin-bottom: 15px; text-align: center;">Rute yang Dapat Dilalui Paket:</div>';
      
      if (paths.length === 0) {
        container.innerHTML += '<div style="text-align: center; color: #e53e3e;">Tidak ada jalur yang tersedia! Pastikan perangkat terhubung.</div>';
        return;
      }

      // Display reliability info
      const reliabilityInfo = document.createElement('div');
      reliabilityInfo.style.cssText = 'background: #fef5e7; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;';
      reliabilityInfo.innerHTML = `<strong>üîí Reliability:</strong> Terdapat <strong>${paths.length}</strong> jalur alternatif. Jika satu jalur gagal, paket dapat menggunakan jalur lain!`;
      container.appendChild(reliabilityInfo);

      // Display each path
      paths.forEach((path, pathIndex) => {
        const pathContainer = document.createElement('div');
        pathContainer.style.cssText = 'margin-bottom: 15px;';

        const pathLabel = document.createElement('div');
        pathLabel.style.cssText = 'font-weight: 600; margin-bottom: 8px; color: #2d3748;';
        pathLabel.textContent = `Jalur ${pathIndex + 1} (${path.length - 1} hop):`;
        pathContainer.appendChild(pathLabel);

        const routePath = document.createElement('div');
        routePath.className = 'route-path';

        path.forEach((deviceId, index) => {
          const node = document.createElement('div');
          node.className = 'route-node';
          node.textContent = deviceNames[deviceId];
          routePath.appendChild(node);

          if (index < path.length - 1) {
            const arrow = document.createElement('div');
            arrow.className = 'route-arrow';
            arrow.textContent = '‚Üí';
            routePath.appendChild(arrow);
          }
        });

        pathContainer.appendChild(routePath);
        container.appendChild(pathContainer);
      });
    }

    function animatePackets(path) {
      const canvas = document.getElementById('networkCanvas');
      const canvasRect = canvas.getBoundingClientRect();

      for (let p = 0; p < 3; p++) {
        setTimeout(() => {
          const packet = document.createElement('div');
          packet.className = 'packet-animation';
          canvas.appendChild(packet);

          let currentIndex = 0;

          function moveToNext() {
            if (currentIndex >= path.length - 1) {
              packet.remove();
              return;
            }

            const currentDevice = document.getElementById(path[currentIndex]);
            const nextDevice = document.getElementById(path[currentIndex + 1]);

            const rect1 = currentDevice.getBoundingClientRect();
            const rect2 = nextDevice.getBoundingClientRect();

            const startX = rect1.left - canvasRect.left + rect1.width / 2;
            const startY = rect1.top - canvasRect.top + rect1.height / 2;
            const endX = rect2.left - canvasRect.left + rect2.width / 2;
            const endY = rect2.top - canvasRect.top + rect2.height / 2;

            packet.style.left = startX + 'px';
            packet.style.top = startY + 'px';

            const duration = 800;
            const startTime = Date.now();

            function animate() {
              const elapsed = Date.now() - startTime;
              const progress = Math.min(elapsed / duration, 1);

              const currentX = startX + (endX - startX) * progress;
              const currentY = startY + (endY - startY) * progress;

              packet.style.left = currentX + 'px';
              packet.style.top = currentY + 'px';

              if (progress < 1) {
                requestAnimationFrame(animate);
              } else {
                currentIndex++;
                moveToNext();
              }
            }

            animate();
          }

          moveToNext();
        }, p * 300);
      }
    }

    onConfigChange(defaultConfig);

    // Reset button functionality
    document.getElementById('resetBtn').addEventListener('click', () => {
      // Reset all state variables
      currentPhase = 1;
      selectedDevices = [];
      connections = [];
      graph = {};
      
      devices.forEach(id => {
        graph[id] = [];
      });

      // Reset phase indicators
      document.getElementById('phase1').classList.add('active');
      document.getElementById('phase2').classList.remove('active');
      document.getElementById('phase3').classList.remove('active');

      // Reset instruction text
      if (window.elementSdk) {
        window.elementSdk.setConfig({
          instruction_text: defaultConfig.instruction_text
        });
      }

      // Clear network canvas connections
      const canvas = document.getElementById('networkCanvas');
      const lines = canvas.querySelectorAll('.connection-line');
      lines.forEach(line => line.remove());

      const packetAnimations = canvas.querySelectorAll('.packet-animation');
      packetAnimations.forEach(packet => packet.remove());

      // Reset device selections
      devices.forEach(id => {
        const device = document.getElementById(id);
        device.classList.remove('selected');
        device.style.cursor = 'pointer';
      });

      // Reset buttons visibility
      document.getElementById('connectBtn').style.display = 'inline-block';
      document.getElementById('connectBtn').disabled = true;
      document.getElementById('finishNetworkBtn').style.display = 'inline-block';
      document.getElementById('finishNetworkBtn').disabled = true;
      document.getElementById('sendMessageBtn').style.display = 'none';

      // Reset message panel
      document.getElementById('messagePanel').style.display = 'none';
      document.getElementById('fromDevice').innerHTML = '<option value="">Dari perangkat...</option>';
      document.getElementById('toDevice').innerHTML = '<option value="">Ke perangkat...</option>';
      document.getElementById('messageText').value = '';
      document.getElementById('packetDisplay').innerHTML = '';
      document.getElementById('routeDisplay').innerHTML = '';

      // Remove error messages
      const existingError = document.getElementById('errorMessage');
      if (existingError) {
        existingError.remove();
      }

      // Reset connection list
      updateConnectionList();
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2e0a023218f902',t:'MTc2NjU1NzcxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
